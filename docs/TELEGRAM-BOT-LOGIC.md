# Telegram Bot Logic

## –°–æ–æ–±—â–µ–Ω–∏–µ ¬´–¢—ã –≤–∑—è–ª –∫—É–ø–æ–Ω¬ª (handleTake)

–ü—Ä–∏ –≤–∑—è—Ç–∏–∏ –∫—É–ø–æ–Ω–∞ (–∫–æ–º–∞–Ω–¥–∞ `/take`, –∫–Ω–æ–ø–∫–∞ ¬´–í–∑—è—Ç—å N¬ª –∏–ª–∏ `take:{id}`) –±–æ—Ç —à–ª—ë—Ç **–æ–¥–Ω–æ** —Å–æ–æ–±—â–µ–Ω–∏–µ:

- **SendPhoto** —Å `caption` –∏ `replyMarkup` (–Ω–µ SendPhoto + –æ—Ç–¥–µ–ª—å–Ω—ã–π SendMessage).
- Caption: `–¢—ã –≤–∑—è–ª –∫—É–ø–æ–Ω {id}: {v} EUR, –∏—Å—Ç–µ–∫–∞–µ—Ç {d}`.
- –ö–Ω–æ–ø–∫–∏: ¬´–í–µ—Ä–Ω—É—Ç—å¬ª, ¬´–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω¬ª ‚Äî `singleTakenKeyboard(coupon)`.
- Callback: `return:{id}:del` –∏ `used:{id}:del`. –°—É—Ñ—Ñ–∏–∫—Å **`:del`** = –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –¥–µ–π—Å—Ç–≤–∏–∏ —É–¥–∞–ª—è—Ç—å **—ç—Ç–æ** —Å–æ–æ–±—â–µ–Ω–∏–µ (`DeleteMessage`), —á—Ç–æ–±—ã –≤ —á–∞—Ç–µ –Ω–µ –æ—Å—Ç–∞–≤–∞–ª–æ—Å—å –Ω–∏ —Ñ–æ—Ç–æ, –Ω–∏ –∫–Ω–æ–ø–æ–∫.

## –ö–æ–º–∞–Ω–¥–∞ /my (handleMy)

- –ü–æ–∫–∞–∑—ã–≤–∞–µ–º **—Ç–æ–ª—å–∫–æ ¬´–ú–æ–∏ –≤–∑—è—Ç—ã–µ¬ª** (–Ω–µ ¬´–ú–æ–∏ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ¬ª).
- –°–ø–∏—Å–æ–∫ —Å—Ç—Ä–æ–∏—Ç—Å—è –∏–∑ `GetCouponsTakenBy`; –ø–æ–¥ –∫–∞–∂–¥—ã–º –∫—É–ø–æ–Ω–æ–º ‚Äî –∫–Ω–æ–ø–∫–∏ ¬´–í–µ—Ä–Ω—É—Ç—å¬ª –∏ ¬´–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω¬ª.
- Callback: `return:{id}` –∏ `used:{id}` **–±–µ–∑** `:del` ‚Äî —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ —É–¥–∞–ª—è–µ–º (—Å–ø–∏—Å–æ–∫ –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫—É–ø–æ–Ω–æ–≤).

## –û–±—Ä–∞–±–æ—Ç–∫–∞ callback (return / used)

- `return:{id}` –∏–ª–∏ `return:{id}:del` ‚Äî `handleReturn`; –ø—Ä–∏ `:del` –∏ —É—Å–ø–µ—Ö–µ (`ok`) ‚Äî `DeleteMessage(cq.Message)` –≤ `try/with`.
- `used:{id}` –∏–ª–∏ `used:{id}:del` ‚Äî `handleUsed`; –ø—Ä–∏ `:del` –∏ —É—Å–ø–µ—Ö–µ ‚Äî `DeleteMessage(cq.Message)` –≤ `try/with`.
- –ü–∞—Ä—Å–∏–Ω–≥: `deleteOnSuccess = cq.Data.EndsWith(":del")`, –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è `id` –æ—Ç—Ä–µ–∑–∞—Ç—å `:del` –∏ –≤–∑—è—Ç—å —á–∏—Å–ª–æ –ø–æ—Å–ª–µ `return:` / `used:`.
- `handleReturn` –∏ `handleUsed` –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç `bool` (—É—Å–ø–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–∏), —á—Ç–æ–±—ã callback —Ä–µ—à–∞–ª, –≤—ã–∑—ã–≤–∞—Ç—å –ª–∏ `DeleteMessage`.

## GetCouponsTakenBy (DbService)

- –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ: `WHERE taken_by = @user_id AND status = 'taken'`.

## /add wizard + OCR

### –û–±—â–∏–π –ø—Ä–∏–Ω—Ü–∏–ø

- `CouponOcrEngine` –¥–µ–ª–∞–µ—Ç barcode + Azure text OCR –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `CouponOCR` –∫–∞–∫ "–µ—Å—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ / –Ω–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è".
- **–õ—é–±–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç OCR ‚Äî —ç—Ç–æ –ª–∏—à—å –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ**: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Å—ë —Ä–∞–≤–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–¥ `AddCoupon`.

### –°—Ç–∞–¥–∏–∏ wizard (PendingAddFlow.stage)

–ë–∞–∑–æ–≤—ã–µ:
- `awaiting_photo`
- `awaiting_discount_choice`
- `awaiting_date_choice`
- `awaiting_confirm`

OCR-–≤–µ—Ç–∫–∞:
- `awaiting_ocr_confirm` ‚Äî –∫–æ–≥–¥–∞ OCR —Ä–∞—Å–ø–æ–∑–Ω–∞–ª value + min_check + expires_at –∏ –ø—Ä–æ—Å–∏–º "–î–∞/–ù–µ—Ç".

### –í–≤–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ wizard (–±–µ–∑ –∫–Ω–æ–ø–æ–∫ "other")

–ù–∞ —à–∞–≥–∞—Ö –≤—ã–±–æ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç **–ª–∏–±–æ –Ω–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫–∏**, –ª–∏–±–æ **–≤–≤–µ—Å—Ç–∏ —Ç–µ–∫—Å—Ç–æ–º**:

- **–°–∫–∏–¥–∫–∞ + –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —á–µ–∫** (–Ω–∞ `awaiting_discount_choice`):
  - –§–æ—Ä–º–∞—Ç `X Y` (–Ω–∞–ø—Ä–∏–º–µ—Ä `10 50`)
  - –§–æ—Ä–º–∞—Ç `X/Y` (–Ω–∞–ø—Ä–∏–º–µ—Ä `10/50`, –ø—Ä–æ–±–µ–ª—ã –≤–æ–∫—Ä—É–≥ `/` –¥–æ–ø—É—Å—Ç–∏–º—ã)
- **–î–∞—Ç–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è** (–Ω–∞ `awaiting_date_choice`):
  - –ü–æ–ª–Ω–∞—è –¥–∞—Ç–∞ (–∫–∞–∫ —Ä–∞–Ω—å—à–µ): `25.01.2026`, `2026-01-25`, `yyyy/MM/dd`, –∏ —Ç.–ø.
  - –£–ø—Ä–æ—â—ë–Ω–Ω–æ: **–æ–¥–Ω–æ —á–∏—Å–ª–æ 1..31** (–Ω–∞–ø—Ä–∏–º–µ—Ä `25`) ‚Äî —Ç—Ä–∞–∫—Ç—É–µ–º –∫–∞–∫ **—Å–ª–µ–¥—É—é—â–µ–µ** —Ç–∞–∫–æ–µ —á–∏—Å–ª–æ **—Å—Ç—Ä–æ–≥–æ –≤ –±—É–¥—É—â–µ–º** (UTC). –ï—Å–ª–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–º –º–µ—Å—è—Ü–µ —Ç–∞–∫–æ–≥–æ –¥–Ω—è –Ω–µ—Ç, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –º–µ—Å—è—Ü –∏ –∏—â–µ–º –¥–∞–ª—å—à–µ.

### Partial OCR (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ)

–ï—Å–ª–∏ OCR —Ä–∞—Å–ø–æ–∑–Ω–∞–ª —á–∞—Å—Ç–∏—á–Ω–æ, **–Ω–µ –æ—Ç–∫–∞—Ç—ã–≤–∞—Ç—å—Å—è "–≤ –Ω–æ–ª—å"**, –∞ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Å –ø–µ—Ä–≤–æ–≥–æ –Ω–µ–¥–æ—Å—Ç–∞—é—â–µ–≥–æ —à–∞–≥–∞, —Å–æ—Ö—Ä–∞–Ω–∏–≤ —Ç–æ, —á—Ç–æ –Ω–∞—à–ª–∏:

- —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω—ã `value` –∏ `min_check`, –Ω–æ –Ω–µ—Ç `expires_at` ‚Üí –ø–µ—Ä–µ–π—Ç–∏ –≤ `awaiting_date_choice`.
- —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–∞ —Ç–æ–ª—å–∫–æ `expires_at` ‚Üí —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –µ—ë, –ø–µ—Ä–µ–π—Ç–∏ –≤ `awaiting_discount_choice`; –ø–æ—Å–ª–µ –≤–≤–æ–¥–∞ —Å–∫–∏–¥–∫–∏/—á–µ–∫–∞ –º–æ–∂–Ω–æ —Å—Ä–∞–∑—É –ø–µ—Ä–µ–π—Ç–∏ –≤ `awaiting_confirm`.
- `barcode_text` –æ–ø—Ü–∏–æ–Ω–∞–ª–µ–Ω –∏ **–Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç** –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ.

### Callback-–ø—Ä–µ—Ñ–∏–∫—Å—ã –≤ /add wizard

- `addflow:disc:<value>:<min_check>` ‚Äî –≤—ã–±—Ä–∞—Ç—å —Å–∫–∏–¥–∫—É –∏ –º–∏–Ω. —á–µ–∫.
- `addflow:date:today|tomorrow` ‚Äî –≤—ã–±—Ä–∞—Ç—å –¥–∞—Ç—É.
- `addflow:ocr:yes|no` ‚Äî –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å/–æ—Ç–∫–ª–æ–Ω–∏—Ç—å OCR-–ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ (–∞–∫—Ç—É–∞–ª—å–Ω–æ —Ç–æ–ª—å–∫–æ –¥–ª—è `awaiting_ocr_confirm`).
- `addflow:confirm` ‚Äî —Å–æ–∑–¥–∞—Ç—å –∫—É–ø–æ–Ω.
- `addflow:cancel` ‚Äî –æ—Ç–º–µ–Ω–∞ wizard.
- `addflow:toggleapp` ‚Äî –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–∏–ø –∫—É–ø–æ–Ω–∞: ¬´üì± –ò–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è¬ª ‚Üî ¬´üßæ –§–∏–∑–∏—á–µ—Å–∫–∏–π¬ª.

### –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –∫—É–ø–æ–Ω–∞ (App / Physical)

OCR-–¥–≤–∏–∂–æ–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –∫—É–ø–æ–Ω –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Dunnes (app coupon) –ø–æ –º–∞—Ä–∫–µ—Ä–∞–º –≤ —Ç–µ–∫—Å—Ç–µ:
- `"Terms and conditions apply"` (—Ä–µ–≥–∏—Å—Ç—Ä–æ–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ)
- `"VALUEclub"` (—Ä–µ–≥–∏—Å—Ç—Ä–æ–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ)
- `"Shop & save voucher"` (—Ä–µ–≥–∏—Å—Ç—Ä–æ–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ)

–ï—Å–ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –º–∞—Ä–∫–µ—Ä –Ω–∞–π–¥–µ–Ω ‚Äî `isAppCoupon = true`. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–∏–ø –∫–Ω–æ–ø–∫–æ–π –Ω–∞ —ç—Ç–∞–ø–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.

üì± App-–∫—É–ø–æ–Ω—ã –ø–æ–º–µ—á–∞—é—Ç—Å—è —ç–º–æ–¥–∑–∏ üì± –≤–æ –≤—Å–µ—Ö –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—è—Ö UI: `/list`, `/my`, `/added`, `/take`, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.

## –ö–æ–º–∞–Ω–¥–∞ /added (handleAdded)

- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫—É–ø–æ–Ω—ã, –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –∞–Ω–Ω—É–ª–∏—Ä–æ–≤–∞—Ç—å (`status IN ('available', 'taken')` –∏ –Ω–µ –∏—Å—Ç—ë–∫—à–∏–µ).
- –ö–∞–∂–¥—ã–π –∫—É–ø–æ–Ω –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å –∫–Ω–æ–ø–∫–æ–π ¬´–ê–Ω–Ω—É–ª–∏—Ä–æ–≤–∞—Ç—å N-—ã–π¬ª (`void:{id}`).
- –¢–∞–∫–∂–µ –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–ª–∏–∞—Å—É `/ad`.
- –ö–Ω–æ–ø–∫–∞ ¬´–ú–æ–∏ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ¬ª –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ `/my` –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞.

## Void Flow (handleVoid)

### –ê–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—É–ø–æ–Ω–∞

- –í–ª–∞–¥–µ–ª–µ—Ü –∫—É–ø–æ–Ω–∞ (–∏–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä) –º–æ–∂–µ—Ç –∞–Ω–Ω—É–ª–∏—Ä–æ–≤–∞—Ç—å –∫—É–ø–æ–Ω –∫–æ–º–∞–Ω–¥–æ–π `/void <id>` –∏–ª–∏ –∫–Ω–æ–ø–∫–æ–π –∏–∑ `/added`.
- –î–æ–ø—É—Å—Ç–∏–º—ã–µ —Å—Ç–∞—Ç—É—Å—ã –¥–ª—è –∞–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω–∏—è: `available`, `taken`. –ù–µ–ª—å–∑—è –∞–Ω–Ω—É–ª–∏—Ä–æ–≤–∞—Ç—å `used` –∏–ª–∏ —É–∂–µ `voided`.
- –ö—É–ø–æ–Ω –Ω–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∏—Å—Ç—ë–∫—à–∏–º.
- –ü—Ä–∏ –∞–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω–∏–∏:
  1. –°—Ç–∞—Ç—É—Å –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ `voided` (—Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω—ã–π).
  2. –°–æ–∑–¥–∞—ë—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ `voided` –≤ `coupon_event`.
  3. –ï—Å–ª–∏ –∫—É–ø–æ–Ω –±—ã–ª –≤–∑—è—Ç (`taken`) ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ª–∏—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Ç–æ–º—É, –∫—Ç–æ –µ–≥–æ –≤–∑—è–ª: ¬´–ö—É–ø–æ–Ω ID:X –±—ã–ª –∞–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω –≤–ª–∞–¥–µ–ª—å—Ü–µ–º. –û–Ω –±–æ–ª—å—à–µ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.¬ª

### Callback-–ø—Ä–µ—Ñ–∏–∫—Å—ã void

- `void:{id}` ‚Äî –∞–Ω–Ω—É–ª–∏—Ä–æ–≤–∞—Ç—å –∫—É–ø–æ–Ω (–±–µ–∑ —É–¥–∞–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è).
- `void:{id}:del` ‚Äî –∞–Ω–Ω—É–ª–∏—Ä–æ–≤–∞—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ —É—Å–ø–µ—Ö–µ.
- `myAdded` ‚Äî –æ—Ç–∫—Ä—ã—Ç—å —Å–ø–∏—Å–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö (–∏–∑ –∫–Ω–æ–ø–∫–∏ –≤ `/my`).

### –ü–µ—Ä–µ—Ö–æ–¥—ã —Å—Ç–∞—Ç—É—Å–æ–≤

```
available ‚Üí taken (take)
available ‚Üí voided (owner void / admin void)
taken ‚Üí used (taker marks used)
taken ‚Üí available (taker returns)
taken ‚Üí voided (owner void / admin void ‚Üí notify taker)
```

`voided` –∏ `used` ‚Äî —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã.

## Daily Reminders (ReminderService)

–ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ —á–∞—Å, –∑–∞–¥–∞–Ω–Ω—ã–π –≤ `REMINDER_HOUR_UTC` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 8:00 UTC).

### –í–∏–¥—ã –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π

1. **–ò—Å—Ç–µ–∫–∞—é—â–∏–µ –∫—É–ø–æ–Ω—ã** (–≤ –≥—Ä—É–ø–ø—É):
   - –ï—Å–ª–∏ —Å–µ–≥–æ–¥–Ω—è –∏—Å—Ç–µ–∫–∞—é—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫—É–ø–æ–Ω—ã, –±–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –≥—Ä—É–ø–ø—É —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –∏ –æ–±—â–µ–π —Å—É–º–º–µ.

2. **–ù–µ–¥–µ–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** (–≤ –≥—Ä—É–ø–ø—É, –ø–æ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞–º):
   - –ü–æ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞–º –±–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π: —Å–∫–æ–ª—å–∫–æ –∫—É–ø–æ–Ω–æ–≤ –∫–∞–∂–¥—ã–π —É—á–∞—Å—Ç–Ω–∏–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –∏ –¥–æ–±–∞–≤–∏–ª.

3. **–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –≤–∑—è—Ç—ã–µ –∫—É–ø–æ–Ω—ã** (–ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è):
   - –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∑—è–ª –∫—É–ø–æ–Ω –±–æ–ª–µ–µ 1 –¥–Ω—è –Ω–∞–∑–∞–¥ –∏ –Ω–µ –ø–æ–º–µ—Ç–∏–ª –µ–≥–æ –∫–∞–∫ ¬´–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω¬ª –∏–ª–∏ ¬´–í–µ—Ä–Ω—É—Ç—å¬ª, –±–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ª–∏—á–Ω–æ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ.

4. **–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –¥–æ–±–∞–≤–∏—Ç—å –∫—É–ø–æ–Ω—ã** (–ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è):
   - –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∫—É–ø–æ–Ω –≤—á–µ—Ä–∞, –Ω–æ –Ω–µ –¥–æ–±–∞–≤–∏–ª –Ω–∏ –æ–¥–Ω–æ–≥–æ –∫—É–ø–æ–Ω–∞ –≤ —Ç–æ—Ç –∂–µ –¥–µ–Ω—å, –±–æ—Ç –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ª–∏—á–Ω–æ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ: ¬´–ù–µ –∑–∞–±—É–¥—å –¥–æ–±–∞–≤–∏—Ç—å –∫—É–ø–æ–Ω—ã –≤ –±–æ—Ç–∞¬ª.
   - –û–¥–Ω–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö –∫—É–ø–æ–Ω–æ–≤.
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Å–Ω–æ–≤—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —Å–æ–±—ã—Ç–∏—è—Ö `coupon_event` —Å —Ç–∏–ø–∞–º–∏ `'used'` –∏ `'added'` –∑–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã–π –¥–µ–Ω—å (UTC).
